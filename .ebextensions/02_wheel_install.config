files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/99_install_wheels.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      set -e
      APP_DIR=/var/app/current
      WHEEL_DIR="$APP_DIR/wheels"
      if [ -d "$WHEEL_DIR" ]; then
        echo "Installing from local wheelhouse: $WHEEL_DIR"
        /usr/bin/python3 -m pip install --no-index --find-links "$WHEEL_DIR" -r "$APP_DIR/requirements.txt"
      else
        echo "No wheel directory found; falling back to pip install -r requirements.txt"
        /usr/bin/python3 -m pip install --no-cache-dir -r "$APP_DIR/requirements.txt"
      fi
